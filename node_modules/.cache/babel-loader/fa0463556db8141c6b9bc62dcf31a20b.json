{"ast":null,"code":"import _slicedToArray from \"/home/burin17/proj/diploma/concept-funder/concept-funder-ui/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/burin17/proj/diploma/concept-funder/concept-funder-ui/src/PayoutRequest.js\";\nimport React, { useState } from \"react\";\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { useEffect } from \"react\";\nimport web3 from \"./contract/web3\";\nimport crowdfundPR from '../contract/crowdfundPayoutRequest';\nexport default function PayoutRequest({\n  pr,\n  fpId,\n  account,\n  currentUserId\n}) {\n  const _React$useState = React.useState(false),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        isLoaded = _React$useState2[0],\n        loaded = _React$useState2[1];\n\n  const _React$useState3 = React.useState(false),\n        _React$useState4 = _slicedToArray(_React$useState3, 2),\n        isInvestor = _React$useState4[0],\n        setIsInvestor = _React$useState4[1];\n\n  const _React$useState5 = React.useState(false),\n        _React$useState6 = _slicedToArray(_React$useState5, 2),\n        isApproved = _React$useState6[0],\n        setIsApproved = _React$useState6[1];\n\n  useEffect(() => {\n    loadData();\n  });\n\n  async function loadData() {\n    // isCurrentUser investor\n    await fetch(\"http://localhost:18080/user/isInvestor?fpId=\" + fpId, {\n      method: \"GET\",\n      headers: new Headers({\n        \"Authorization\": sessionStorage.jwtToken\n      })\n    }).then(response => response.json()).then(data => setIsInvestor(data));\n\n    if (isInvestor) {\n      await fetch(\"http://localhost:18080/payout-requests/isApproved?prId=\" + pr.id, {\n        method: \"GET\",\n        headers: new Headers({\n          \"Authorization\": sessionStorage.jwtToken\n        })\n      }).then(response => response.json()).then(data => setIsApproved(data));\n    }\n\n    loaded(true);\n  }\n\n  if (isLoaded === false) {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38\n      },\n      __self: this\n    });\n  }\n\n  async function approve() {\n    const countOfApproves = await crowdfundPR(pr.contractAddress).methods.approve().send({\n      from: account\n    }).then(res => {\n      return parseInt(res.events.Approved.returnValues.countOfApproves);\n    });\n    await fetch(\"http://localhost:18080/payout-requests/approve?payoutRequestId=\" + pr.id + \"&approverId=\" + currentUserId, {\n      method: \"POST\",\n      headers: new Headers({\n        \"Authorization\": sessionStorage.jwtToken\n      })\n    });\n  }\n\n  return React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"bg-light m-5 p-3 fpWrapper\",\n    style: {\n      borderRadius: \"15px\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58\n    },\n    __self: this\n  }, React.createElement(\"h3\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59\n    },\n    __self: this\n  }, \"Requested sum: \", pr.ethAmount), React.createElement(\"div\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60\n    },\n    __self: this\n  }, \"Intention: \", pr.intention), React.createElement(\"div\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61\n    },\n    __self: this\n  }, \"Promised report: \", pr.reporting), React.createElement(\"div\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62\n    },\n    __self: this\n  }, \"Due date: \", pr.achieveBy.substring(0, pr.achieveBy.indexOf('T'))), isInvestor && !isApproved && React.createElement(\"button\", {\n    id: \"startBtn\",\n    type: \"button\",\n    className: \"m-2 btn btn-primary\",\n    onClick: () => approve(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64\n    },\n    __self: this\n  }, \"Approve\")));\n}","map":{"version":3,"sources":["/home/burin17/proj/diploma/concept-funder/concept-funder-ui/src/PayoutRequest.js"],"names":["React","useState","useEffect","web3","crowdfundPR","PayoutRequest","pr","fpId","account","currentUserId","isLoaded","loaded","isInvestor","setIsInvestor","isApproved","setIsApproved","loadData","fetch","method","headers","Headers","sessionStorage","jwtToken","then","response","json","data","id","approve","countOfApproves","contractAddress","methods","send","from","res","parseInt","events","Approved","returnValues","borderRadius","ethAmount","intention","reporting","achieveBy","substring","indexOf"],"mappings":"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","sourcesContent":["import React, {useState} from \"react\";\nimport 'bootstrap/dist/css/bootstrap.css';\nimport {useEffect} from \"react\";\nimport web3 from \"./contract/web3\";\nimport crowdfundPR from '../contract/crowdfundPayoutRequest';\n\nexport default function PayoutRequest({pr, fpId, account, currentUserId}) {\n    const [isLoaded, loaded] = React.useState(false);\n    const [isInvestor, setIsInvestor] = React.useState(false);\n    const [isApproved, setIsApproved] = React.useState(false);\n\n    useEffect(() =>{\n        loadData();\n    })\n\n    async function loadData() {\n        // isCurrentUser investor\n        await fetch(\"http://localhost:18080/user/isInvestor?fpId=\" + fpId, {\n            method: \"GET\",\n            headers: new Headers({\n                \"Authorization\": sessionStorage.jwtToken\n            })\n        }).then(response => response.json())\n            .then(data => setIsInvestor(data));\n        if (isInvestor) {\n            await fetch(\"http://localhost:18080/payout-requests/isApproved?prId=\" + pr.id, {\n                method: \"GET\",\n                headers: new Headers({\n                    \"Authorization\": sessionStorage.jwtToken\n                })\n            }).then(response => response.json())\n                .then(data => setIsApproved(data));\n        }\n        loaded(true);\n    }\n\n    if (isLoaded === false) {\n        return <div></div>\n    }\n\n    async function approve() {\n        const countOfApproves = await crowdfundPR(pr.contractAddress).methods.approve().send({\n            from: account\n        }).then(res => {\n            return parseInt(res.events.Approved.returnValues.countOfApproves);\n        })\n        await fetch(\"http://localhost:18080/payout-requests/approve?payoutRequestId=\" +\n            pr.id + \"&approverId=\" + currentUserId, {\n            method: \"POST\",\n            headers: new Headers({\n                \"Authorization\": sessionStorage.jwtToken,\n            }),\n        })\n    }\n\n    return (\n        <li>\n            <div className=\"bg-light m-5 p-3 fpWrapper\" style={{borderRadius: \"15px\"}}>\n                <h3 className=\"p-3\">Requested sum: {pr.ethAmount}</h3>\n                <div className=\"p-3\">Intention: {pr.intention}</div>\n                <div className=\"p-3\">Promised report: {pr.reporting}</div>\n                <div className=\"p-3\">Due date: {pr.achieveBy.substring(0, pr.achieveBy.indexOf('T'))}</div>\n                {isInvestor && !isApproved &&\n                    <button id=\"startBtn\" type=\"button\" className=\"m-2 btn btn-primary\" onClick={() => approve()}>Approve</button>\n                }\n                {/*<div className=\"p-3\">{pr.countOfApprovers}</div>*/}\n            </div>\n        </li>\n    )\n}"]},"metadata":{},"sourceType":"module"}