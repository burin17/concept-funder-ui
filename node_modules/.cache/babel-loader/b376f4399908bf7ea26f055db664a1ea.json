{"ast":null,"code":"import _slicedToArray from \"/home/burin17/proj/diploma/concept-funder/concept-funder-ui/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/burin17/proj/diploma/concept-funder/concept-funder-ui/src/FundraisingProject/FundraisingProject.js\";\nimport React, { useState } from \"react\";\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { useEffect } from \"react\";\nimport crowdfundInstance from '../contract/crowdfundInstance';\nimport crowdfundProject from '../contract/crowdfundProjectInstance';\nimport web3 from '../contract/web3';\nimport { BrowserRouter, Route, Switch, Link } from \"react-router-dom\";\nimport { withRouter } from \"react-router-dom\";\nimport '../loading.css';\n\nfunction FundraisingProject({\n  fp,\n  isModeration,\n  isSelfProfile,\n  isCurrentUser\n}) {\n  const _React$useState = React.useState(fp),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        fProj = _React$useState2[0],\n        setFp = _React$useState2[1];\n\n  const _React$useState3 = React.useState(false),\n        _React$useState4 = _slicedToArray(_React$useState3, 2),\n        isInApprovedState = _React$useState4[0],\n        setIsInApprovedState = _React$useState4[1];\n\n  const _React$useState5 = React.useState(false),\n        _React$useState6 = _slicedToArray(_React$useState5, 2),\n        isNotConsidered = _React$useState6[0],\n        setIsNotConsidered = _React$useState6[1];\n\n  const _React$useState7 = React.useState(false),\n        _React$useState8 = _slicedToArray(_React$useState7, 2),\n        isDurationAvailable = _React$useState8[0],\n        setIsDurationAvailable = _React$useState8[1];\n\n  const _React$useState9 = React.useState([]),\n        _React$useState10 = _slicedToArray(_React$useState9, 2),\n        accounts = _React$useState10[0],\n        setAccounts = _React$useState10[1];\n\n  const _React$useState11 = React.useState(false),\n        _React$useState12 = _slicedToArray(_React$useState11, 2),\n        loading = _React$useState12[0],\n        setLoading = _React$useState12[1];\n\n  const _React$useState13 = React.useState(false),\n        _React$useState14 = _slicedToArray(_React$useState13, 2),\n        isExpired = _React$useState14[0],\n        setIsExpired = _React$useState14[1];\n\n  function approve() {\n    fetch(\"http://localhost:18080/moderation/\".concat(fProj.fundraisingProjectId, \"?\") + new URLSearchParams({\n      isValid: true\n    }), {\n      method: 'POST',\n      headers: new Headers({\n        \"Authorization\": sessionStorage.jwtToken\n      })\n    }).then(response => response.json()).then(data => {\n      setFp(data);\n      setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n    });\n  }\n\n  function reject() {\n    fetch(\"http://localhost:18080/moderation/\".concat(fProj.fundraisingProjectId, \"?\") + new URLSearchParams({\n      isValid: false\n    }), {\n      method: 'POST',\n      headers: new Headers({\n        \"Authorization\": sessionStorage.jwtToken\n      })\n    }).then(response => response.json()).then(data => {\n      setFp(data);\n      setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n    });\n  }\n\n  function startFp() {\n    setLoading(true);\n    document.getElementsByName(\"body\")[0].style; // crowdfundInstance.methods.startProject(\n    //     fProj.title,\n    //     fProj.days,\n    //     web3.utils.toWei(String(fProj.amountGoal), 'ether'),\n    // ).send({\n    //     from: accounts[0],\n    // }).then((res) => {\n    //     const projectInfo = res.events.ProjectStarted.returnValues;\n    //     setLoading(false);\n    //     projectInfo.currentAmount = 0;\n    //     projectInfo.currentState = 0;\n    //     projectInfo.contract = crowdfundProject(projectInfo.contractAddress);\n    //     console.log(projectInfo);\n    //     fetch(`http://localhost:18080/fundraising-projects/start?id=` + fProj.fundraisingProjectId\n    //         + \"&contractAddress=\" + projectInfo.contractAddress, {\n    //         method: 'POST',\n    //         headers: new Headers({\n    //             \"Authorization\": sessionStorage.jwtToken\n    //         })\n    //     }).then(response => response.json())\n    //       .then(data => {\n    //         setFp(data);\n    //         setIsInApprovedState(false);\n    //         setIsDurationAvailable(true);\n    //       });\n    // });\n  }\n\n  useEffect(() => {\n    setFp(fp);\n    setIsInApprovedState(fProj.status == \"APPROVED\");\n    setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n    setIsDurationAvailable(fProj.duration != undefined);\n    web3.eth.getAccounts().then(accounts => {\n      setAccounts(accounts);\n    });\n\n    if (Date.parse(fp.duration) < Date.now() && fp.status == \"IN_PROGRESS\") {\n      fetch(\"http://localhost:18080/fundraising-projects/expired?fpId=\" + fp.fundraisingProjectId, {\n        method: \"POST\",\n        headers: new Headers({\n          \"Authorization\": sessionStorage.jwtToken\n        })\n      }).then(response => response.json()).then(data => {\n        setFp(data);\n      }).then(() => {\n        setIsExpired(true);\n      });\n    }\n  }, [fp]);\n  return React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }, loading && React.createElement(\"div\", {\n    className: \"loader\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"bg-light m-5 p-3 fpWrapper\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }, React.createElement(Link, {\n    fp: fProj,\n    to: {\n      pathname: \"/fundraising-project-details/\".concat(fProj.fundraisingProjectId),\n      state: {\n        isModeration: isModeration\n      }\n    },\n    style: {\n      textDecoration: 'none'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }, React.createElement(\"h2\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }, fProj.title)), React.createElement(\"div\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113\n    },\n    __self: this\n  }, fProj.description), React.createElement(\"div\", {\n    className: \"row p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col-sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }, \"User: \", fProj.founder.username), React.createElement(\"div\", {\n    className: \"col-sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }, \"Goal: \", fProj.amountGoal, \" ETH\"), isDurationAvailable > 0 && React.createElement(\"div\", {\n    className: \"col-sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, \"Due date: \", fProj.duration.substring(0, fProj.duration.indexOf('T'))), isModeration > 0 && React.createElement(\"div\", {\n    className: \"col-sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, \"Days: \", fProj.days), React.createElement(\"div\", {\n    className: \"col-sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }, \"Raised: \", fProj.currentAmount, \" ETH\")), React.createElement(\"div\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, \"Tags: \"), isModeration > 0 && React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, \"Status: \", fProj.status), isNotConsidered > 0 && React.createElement(\"div\", {\n    className: \"p-1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    type: \"button\",\n    className: \"btn btn-primary btn-block m-2\",\n    onClick: () => approve(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, \"Approve\"), React.createElement(\"button\", {\n    type: \"button\",\n    className: \"btn btn-primary btn-block m-2\",\n    onClick: () => reject(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134\n    },\n    __self: this\n  }, \"Reject\"))), isSelfProfile > 0 && !(isModeration > 0) && React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }, \"Status: \", fProj.status)), isInApprovedState > 0 && isSelfProfile > 0 && React.createElement(\"button\", {\n    id: \"startBtn\",\n    type: \"button\",\n    className: \"btn btn-primary btn-block m-2\",\n    onClick: () => startFp(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147\n    },\n    __self: this\n  }, \"Start company\"), isExpired && isSelfProfile && React.createElement(\"button\", {\n    id: \"startBtn\",\n    type: \"button\",\n    className: \"btn btn-danger btn-block m-2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150\n    },\n    __self: this\n  }, \"Refund\")));\n}\n\nexport default withRouter(FundraisingProject);","map":{"version":3,"sources":["/home/burin17/proj/diploma/concept-funder/concept-funder-ui/src/FundraisingProject/FundraisingProject.js"],"names":["React","useState","useEffect","crowdfundInstance","crowdfundProject","web3","BrowserRouter","Route","Switch","Link","withRouter","FundraisingProject","fp","isModeration","isSelfProfile","isCurrentUser","fProj","setFp","isInApprovedState","setIsInApprovedState","isNotConsidered","setIsNotConsidered","isDurationAvailable","setIsDurationAvailable","accounts","setAccounts","loading","setLoading","isExpired","setIsExpired","approve","fetch","fundraisingProjectId","URLSearchParams","isValid","method","headers","Headers","sessionStorage","jwtToken","then","response","json","data","status","reject","startFp","document","getElementsByName","style","duration","undefined","eth","getAccounts","Date","parse","now","pathname","state","textDecoration","title","description","founder","username","amountGoal","substring","indexOf","days","currentAmount"],"mappings":"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","sourcesContent":["import React, {useState} from \"react\";\nimport 'bootstrap/dist/css/bootstrap.css';\nimport {useEffect} from \"react\";\nimport crowdfundInstance from '../contract/crowdfundInstance';\nimport crowdfundProject from '../contract/crowdfundProjectInstance';\nimport web3 from '../contract/web3';\nimport { BrowserRouter, Route, Switch, Link } from \"react-router-dom\";\nimport {withRouter} from \"react-router-dom\";\nimport '../loading.css';\n\nfunction FundraisingProject({fp, isModeration, isSelfProfile, isCurrentUser}) {\n    const [fProj, setFp] = React.useState(fp);\n    const [isInApprovedState, setIsInApprovedState] = React.useState(false);\n    const [isNotConsidered, setIsNotConsidered] = React.useState(false);\n    const [isDurationAvailable, setIsDurationAvailable] = React.useState(false);\n    const [accounts, setAccounts] = React.useState([]);\n    const [loading, setLoading] = React.useState(false);\n    const [isExpired, setIsExpired] = React.useState(false);\n\n    function approve() {\n        fetch(`http://localhost:18080/moderation/${fProj.fundraisingProjectId}?` + new URLSearchParams({\n            isValid: true,\n        }), {\n            method: 'POST',\n            headers: new Headers({\n                \"Authorization\": sessionStorage.jwtToken\n            })\n        }).then(response => response.json())\n            .then(data => {\n                setFp(data);\n                setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n            });\n    }\n\n    function reject() {\n        fetch(`http://localhost:18080/moderation/${fProj.fundraisingProjectId}?` + new URLSearchParams({\n            isValid: false,\n        }), {\n            method: 'POST',\n            headers: new Headers({\n                \"Authorization\": sessionStorage.jwtToken\n            })\n        }).then(response => response.json())\n            .then(data => {\n                setFp(data);\n                setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n            });\n    }\n\n    function startFp() {\n        setLoading(true);\n        document.getElementsByName(\"body\")[0].style\n        // crowdfundInstance.methods.startProject(\n        //     fProj.title,\n        //     fProj.days,\n        //     web3.utils.toWei(String(fProj.amountGoal), 'ether'),\n        // ).send({\n        //     from: accounts[0],\n        // }).then((res) => {\n        //     const projectInfo = res.events.ProjectStarted.returnValues;\n        //     setLoading(false);\n        //     projectInfo.currentAmount = 0;\n        //     projectInfo.currentState = 0;\n        //     projectInfo.contract = crowdfundProject(projectInfo.contractAddress);\n        //     console.log(projectInfo);\n        //     fetch(`http://localhost:18080/fundraising-projects/start?id=` + fProj.fundraisingProjectId\n        //         + \"&contractAddress=\" + projectInfo.contractAddress, {\n        //         method: 'POST',\n        //         headers: new Headers({\n        //             \"Authorization\": sessionStorage.jwtToken\n        //         })\n        //     }).then(response => response.json())\n        //       .then(data => {\n        //         setFp(data);\n        //         setIsInApprovedState(false);\n        //         setIsDurationAvailable(true);\n        //       });\n        // });\n    }\n\n\n    useEffect(() =>{\n        setFp(fp)\n        setIsInApprovedState(fProj.status == \"APPROVED\");\n        setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n        setIsDurationAvailable(fProj.duration != undefined);\n        web3.eth.getAccounts().then((accounts) => {\n            setAccounts(accounts);\n        });\n        if (Date.parse(fp.duration) < Date.now() && fp.status == \"IN_PROGRESS\") {\n            fetch(\"http://localhost:18080/fundraising-projects/expired?fpId=\" + fp.fundraisingProjectId, {\n                method: \"POST\",\n                headers: new Headers({\n                    \"Authorization\": sessionStorage.jwtToken\n                })\n            }).then(response => response.json())\n                .then(data => {\n                    setFp(data);\n                }).then(() => {\n                    setIsExpired(true);\n            });\n        }\n    },[fp])\n\n\n    return (\n        <li>\n            {loading &&\n                <div className=\"loader\"></div>\n            }\n            <div className=\"bg-light m-5 p-3 fpWrapper\">\n                <Link fp={fProj} to={{pathname:`/fundraising-project-details/${fProj.fundraisingProjectId}`, state: {isModeration: isModeration}}} style={{ textDecoration: 'none' }}><h2 className=\"p-3\">{fProj.title}</h2></Link>\n                <div className=\"p-3\">{fProj.description}</div>\n                <div className=\"row p-3\">\n                    <div className=\"col-sm\">User: {fProj.founder.username}</div>\n                    <div className=\"col-sm\">Goal: {fProj.amountGoal} ETH</div>\n                    {isDurationAvailable > 0 &&\n                        <div className=\"col-sm\">Due date: {fProj.duration.substring(0, fProj.duration.indexOf('T'))}</div>\n                    }\n                    {isModeration > 0 &&\n                        <div className=\"col-sm\">Days: {fProj.days}</div>\n                    }\n                    <div className=\"col-sm\">Raised: {fProj.currentAmount} ETH</div>\n                </div>\n                <div className=\"p-3\">Tags: </div>\n                {isModeration > 0 &&\n                    <div>\n                        <div className=\"p-3\">Status: {fProj.status}</div>\n                        {isNotConsidered > 0 &&\n                            <div className=\"p-1\">\n                                <button type=\"button\" className=\"btn btn-primary btn-block m-2\"\n                                        onClick={() => approve()}>Approve\n                                </button>\n                                <button type=\"button\" className=\"btn btn-primary btn-block m-2\"\n                                        onClick={() => reject()}>Reject\n                                </button>\n                            </div>\n                        }\n                    </div>\n                }\n                {isSelfProfile > 0 && !(isModeration > 0) &&\n                    <div>\n                        <div className=\"p-3\">Status: {fProj.status}</div>\n                    </div>\n                }\n                {isInApprovedState > 0 && isSelfProfile > 0 &&\n                    <button id=\"startBtn\" type=\"button\" className=\"btn btn-primary btn-block m-2\" onClick={() => startFp()}>Start company</button>\n                }\n                {isExpired && isSelfProfile &&\n                    <button id=\"startBtn\" type=\"button\" className=\"btn btn-danger btn-block m-2\">Refund</button>\n                }\n            </div>\n        </li>\n    )\n}\n\nexport default withRouter(FundraisingProject);"]},"metadata":{},"sourceType":"module"}