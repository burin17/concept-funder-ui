{"ast":null,"code":"import _slicedToArray from \"/home/burin17/proj/diploma/concept-funder/concept-funder-ui/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/burin17/proj/diploma/concept-funder/concept-funder-ui/src/FundraisingProject/FundraisingProject.js\";\nimport React, { useState } from \"react\";\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { useEffect } from \"react\";\nimport crowdfundInstance from '../contract/crowdfundInstance';\nimport crowdfundProject from '../contract/crowdfundProjectInstance';\nimport web3 from '../contract/web3';\nimport { BrowserRouter, Route, Switch, Link } from \"react-router-dom\";\nimport { withRouter } from \"react-router-dom\";\n\nfunction FundraisingProject({\n  fp,\n  isModeration,\n  isSelfProfile\n}) {\n  const _React$useState = React.useState(fp),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        fProj = _React$useState2[0],\n        setFp = _React$useState2[1];\n\n  const _React$useState3 = React.useState(false),\n        _React$useState4 = _slicedToArray(_React$useState3, 2),\n        isInApprovedState = _React$useState4[0],\n        setIsInApprovedState = _React$useState4[1];\n\n  const _React$useState5 = React.useState(false),\n        _React$useState6 = _slicedToArray(_React$useState5, 2),\n        isNotConsidered = _React$useState6[0],\n        setIsNotConsidered = _React$useState6[1];\n\n  const _React$useState7 = React.useState(false),\n        _React$useState8 = _slicedToArray(_React$useState7, 2),\n        isDurationAvailable = _React$useState8[0],\n        setIsDurationAvailable = _React$useState8[1];\n\n  const _React$useState9 = React.useState([]),\n        _React$useState10 = _slicedToArray(_React$useState9, 2),\n        accounts = _React$useState10[0],\n        setAccounts = _React$useState10[1];\n\n  const _React$useState11 = React.useState(false),\n        _React$useState12 = _slicedToArray(_React$useState11, 2),\n        isLoaded = _React$useState12[0],\n        setIsLoaded = _React$useState12[1];\n\n  function approve() {\n    fetch(\"http://localhost:18080/moderation/\".concat(fProj.fundraisingProjectId, \"?\") + new URLSearchParams({\n      isValid: true\n    }), {\n      method: 'POST',\n      headers: new Headers({\n        \"Authorization\": sessionStorage.jwtToken\n      })\n    }).then(response => response.json()).then(data => {\n      setFp(data);\n      setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n    });\n  }\n\n  function reject() {\n    fetch(\"http://localhost:18080/moderation/\".concat(fProj.fundraisingProjectId, \"?\") + new URLSearchParams({\n      isValid: false\n    }), {\n      method: 'POST',\n      headers: new Headers({\n        \"Authorization\": sessionStorage.jwtToken\n      })\n    }).then(response => response.json()).then(data => {\n      setFp(data);\n      setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n    });\n  }\n\n  function startFp() {\n    crowdfundInstance.methods.startProject(fProj.title, fProj.description, fProj.days, web3.utils.toWei(String(fProj.amountGoal), 'ether')).send({\n      from: accounts[0]\n    }).then(res => {\n      const projectInfo = res.events.ProjectStarted.returnValues;\n      projectInfo.isLoading = false;\n      projectInfo.currentAmount = 0;\n      projectInfo.currentState = 0;\n      projectInfo.contract = crowdfundProject(projectInfo.contractAddress);\n      console.log(projectInfo);\n      fetch(\"http://localhost:18080/fundraising-projects/start?id=\" + fProj.fundraisingProjectId + \"&contractAddress=\" + projectInfo.contractAddress, {\n        method: 'POST',\n        headers: new Headers({\n          \"Authorization\": sessionStorage.jwtToken\n        })\n      }).then(response => response.json()).then(data => {\n        setFp(data);\n        setIsInApprovedState(false);\n        setIsDurationAvailable(true);\n      });\n    });\n  }\n\n  function invest() {\n    const ethAmount = document.getElementById(\"ethAmount\").value;\n    const contractAddress = fProj.contractAddress;\n    crowdfundProject(contractAddress).methods.contribute().send({\n      from: accounts[0],\n      value: web3.utils.toWei(String(ethAmount), 'ether')\n    }).then(res => {\n      const currentAmount = parseInt(res.events.FundingReceived.returnValues.currentTotal, 10) / 1000000000000000000;\n      fProj.currentAmount = currentAmount;\n      fetch(\"http://localhost:18080/fundraising-projects/invest?id=\" + fProj.fundraisingProjectId + \"&currentAmount=\" + currentAmount, {\n        method: 'POST',\n        headers: new Headers({\n          \"Authorization\": sessionStorage.jwtToken\n        })\n      }).then(response => response.json()).then(data => {\n        setFp(data);\n      });\n    });\n  }\n\n  useEffect(() => {\n    setFp(fp);\n    setIsInApprovedState(fProj.status == \"APPROVED\");\n    setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n    setIsDurationAvailable(fProj.duration != undefined);\n    web3.eth.getAccounts().then(accounts => {\n      setAccounts(accounts);\n      setCurrentBalance();\n    });\n  }, [fp]);\n\n  function setCurrentBalance(acc) {\n    crowdfundProject(fp.contractAddress).method.getCurrentBalance().send({\n      from: acc\n    }).then(res => {\n      fProj.currentAmount = res.result;\n      setIsLoaded(true);\n    });\n  }\n\n  return React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"bg-light m-5 p-3 fpWrapper\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, React.createElement(Link, {\n    fp: fProj,\n    to: \"/fundraising-project-details/\".concat(fProj.fundraisingProjectId),\n    style: {\n      textDecoration: 'none'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, React.createElement(\"h2\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, fProj.title)), React.createElement(\"div\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }, fProj.description), React.createElement(\"div\", {\n    className: \"row p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col-sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, \"User: \", fProj.founder.username), React.createElement(\"div\", {\n    className: \"col-sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, \"Goal: \", fProj.amountGoal, \" ETH\"), isDurationAvailable > 0 && React.createElement(\"div\", {\n    className: \"col-sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, \"Due date: \", fProj.duration.substring(0, fProj.duration.indexOf('T'))), isModeration > 0 && React.createElement(\"div\", {\n    className: \"col-sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, \"Days: \", fProj.days), React.createElement(\"div\", {\n    className: \"col-sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133\n    },\n    __self: this\n  }, \"Raised: \", fProj.currentAmount, \" ETH\")), React.createElement(\"div\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135\n    },\n    __self: this\n  }, \"Tags: \"), isModeration > 0 && React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138\n    },\n    __self: this\n  }, \"Status: \", fProj.status), isNotConsidered > 0 && React.createElement(\"div\", {\n    className: \"p-1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    type: \"button\",\n    className: \"btn btn-primary btn-block m-2\",\n    onClick: () => approve(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141\n    },\n    __self: this\n  }, \"Approve\"), React.createElement(\"button\", {\n    type: \"button\",\n    className: \"btn btn-primary btn-block m-2\",\n    onClick: () => reject(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }, \"Reject\"))), isSelfProfile > 0 && !(isModeration > 0) && React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"p-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153\n    },\n    __self: this\n  }, \"Status: \", fProj.status)), isInApprovedState > 0 && isSelfProfile > 0 && React.createElement(\"button\", {\n    id: \"startBtn\",\n    type: \"button\",\n    className: \"btn btn-primary btn-block m-2\",\n    onClick: () => startFp(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, \"Start company\"), isModeration <= 0 && isSelfProfile <= 0 && React.createElement(\"div\", {\n    className: \"input-group m-2 w-25\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    id: \"ethAmount\",\n    type: \"text\",\n    className: \"form-control\",\n    placeholder: \"ETH amount\",\n    \"aria-label\": \"ETH amount\",\n    \"aria-describedby\": \"basic-addon2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }), React.createElement(\"button\", {\n    id: \"startBtn\",\n    type: \"button\",\n    className: \"btn btn-primary\",\n    onClick: () => invest(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, \"Contribute\"))));\n}\n\nexport default withRouter(FundraisingProject);","map":{"version":3,"sources":["/home/burin17/proj/diploma/concept-funder/concept-funder-ui/src/FundraisingProject/FundraisingProject.js"],"names":["React","useState","useEffect","crowdfundInstance","crowdfundProject","web3","BrowserRouter","Route","Switch","Link","withRouter","FundraisingProject","fp","isModeration","isSelfProfile","fProj","setFp","isInApprovedState","setIsInApprovedState","isNotConsidered","setIsNotConsidered","isDurationAvailable","setIsDurationAvailable","accounts","setAccounts","isLoaded","setIsLoaded","approve","fetch","fundraisingProjectId","URLSearchParams","isValid","method","headers","Headers","sessionStorage","jwtToken","then","response","json","data","status","reject","startFp","methods","startProject","title","description","days","utils","toWei","String","amountGoal","send","from","res","projectInfo","events","ProjectStarted","returnValues","isLoading","currentAmount","currentState","contract","contractAddress","console","log","invest","ethAmount","document","getElementById","value","contribute","parseInt","FundingReceived","currentTotal","duration","undefined","eth","getAccounts","setCurrentBalance","acc","getCurrentBalance","result","textDecoration","founder","username","substring","indexOf"],"mappings":"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","sourcesContent":["import React, {useState} from \"react\";\nimport 'bootstrap/dist/css/bootstrap.css';\nimport {useEffect} from \"react\";\nimport crowdfundInstance from '../contract/crowdfundInstance';\nimport crowdfundProject from '../contract/crowdfundProjectInstance';\nimport web3 from '../contract/web3';\nimport { BrowserRouter, Route, Switch, Link } from \"react-router-dom\";\nimport {withRouter} from \"react-router-dom\";\n\nfunction FundraisingProject({fp, isModeration, isSelfProfile}) {\n    const [fProj, setFp] = React.useState(fp);\n    const [isInApprovedState, setIsInApprovedState] = React.useState(false);\n    const [isNotConsidered, setIsNotConsidered] = React.useState(false);\n    const [isDurationAvailable, setIsDurationAvailable] = React.useState(false);\n    const [accounts, setAccounts] = React.useState([]);\n    const [isLoaded, setIsLoaded] = React.useState(false);\n\n    function approve() {\n        fetch(`http://localhost:18080/moderation/${fProj.fundraisingProjectId}?` + new URLSearchParams({\n            isValid: true,\n        }), {\n            method: 'POST',\n            headers: new Headers({\n                \"Authorization\": sessionStorage.jwtToken\n            })\n        }).then(response => response.json())\n            .then(data => {\n                setFp(data);\n                setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n            });\n    }\n\n    function reject() {\n        fetch(`http://localhost:18080/moderation/${fProj.fundraisingProjectId}?` + new URLSearchParams({\n            isValid: false,\n        }), {\n            method: 'POST',\n            headers: new Headers({\n                \"Authorization\": sessionStorage.jwtToken\n            })\n        }).then(response => response.json())\n            .then(data => {\n                setFp(data);\n                setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n            });\n    }\n\n    function startFp() {\n        crowdfundInstance.methods.startProject(\n            fProj.title,\n            fProj.description,\n            fProj.days,\n            web3.utils.toWei(String(fProj.amountGoal), 'ether'),\n        ).send({\n            from: accounts[0],\n        }).then((res) => {\n            const projectInfo = res.events.ProjectStarted.returnValues;\n            projectInfo.isLoading = false;\n            projectInfo.currentAmount = 0;\n            projectInfo.currentState = 0;\n            projectInfo.contract = crowdfundProject(projectInfo.contractAddress);\n            console.log(projectInfo);\n            fetch(`http://localhost:18080/fundraising-projects/start?id=` + fProj.fundraisingProjectId\n                + \"&contractAddress=\" + projectInfo.contractAddress, {\n                method: 'POST',\n                headers: new Headers({\n                    \"Authorization\": sessionStorage.jwtToken\n                })\n            }).then(response => response.json())\n              .then(data => {\n                setFp(data);\n                setIsInApprovedState(false);\n                setIsDurationAvailable(true);\n              });\n        });\n    }\n\n    function invest() {\n        const ethAmount = document.getElementById(\"ethAmount\").value;\n        const contractAddress = fProj.contractAddress;\n        crowdfundProject(contractAddress).methods.contribute().send({\n            from: accounts[0],\n            value: web3.utils.toWei(String(ethAmount), 'ether'),\n        }).then((res) => {\n            const currentAmount = (parseInt(res.events.FundingReceived.returnValues.currentTotal, 10) / 1000000000000000000);\n            fProj.currentAmount = currentAmount;\n            fetch(`http://localhost:18080/fundraising-projects/invest?id=` + fProj.fundraisingProjectId\n                + \"&currentAmount=\" + currentAmount, {\n                method: 'POST',\n                headers: new Headers({\n                    \"Authorization\": sessionStorage.jwtToken\n                })\n            }).then(response => response.json())\n              .then(data => {\n                    setFp(data);\n                });\n        });\n    }\n\n    useEffect(() =>{\n        setFp(fp)\n        setIsInApprovedState(fProj.status == \"APPROVED\");\n        setIsNotConsidered(fProj.status == \"NOT_CONSIDERED\");\n        setIsDurationAvailable(fProj.duration != undefined);\n        web3.eth.getAccounts().then((accounts) => {\n            setAccounts(accounts);\n            setCurrentBalance();\n        });\n    },[fp])\n\n    function setCurrentBalance(acc) {\n        crowdfundProject(fp.contractAddress).method.getCurrentBalance().send({\n            from: acc\n        }).then(res => {\n            fProj.currentAmount = res.result;\n            setIsLoaded(true);\n        });\n    }\n    return (\n        <li>\n            <div className=\"bg-light m-5 p-3 fpWrapper\">\n                <Link fp={fProj} to={`/fundraising-project-details/${fProj.fundraisingProjectId}`} style={{ textDecoration: 'none' }}><h2 className=\"p-3\">{fProj.title}</h2></Link>\n                <div className=\"p-3\">{fProj.description}</div>\n                <div className=\"row p-3\">\n                    <div className=\"col-sm\">User: {fProj.founder.username}</div>\n                    <div className=\"col-sm\">Goal: {fProj.amountGoal} ETH</div>\n                    {isDurationAvailable > 0 &&\n                        <div className=\"col-sm\">Due date: {fProj.duration.substring(0, fProj.duration.indexOf('T'))}</div>\n                    }\n                    {isModeration > 0 &&\n                        <div className=\"col-sm\">Days: {fProj.days}</div>\n                    }\n                    <div className=\"col-sm\">Raised: {fProj.currentAmount} ETH</div>\n                </div>\n                <div className=\"p-3\">Tags: </div>\n                {isModeration > 0 &&\n                    <div>\n                        <div className=\"p-3\">Status: {fProj.status}</div>\n                        {isNotConsidered > 0 &&\n                            <div className=\"p-1\">\n                                <button type=\"button\" className=\"btn btn-primary btn-block m-2\"\n                                        onClick={() => approve()}>Approve\n                                </button>\n                                <button type=\"button\" className=\"btn btn-primary btn-block m-2\"\n                                        onClick={() => reject()}>Reject\n                                </button>\n                            </div>\n                        }\n                    </div>\n                }\n                {isSelfProfile > 0 && !(isModeration > 0) &&\n                    <div>\n                        <div className=\"p-3\">Status: {fProj.status}</div>\n                    </div>\n                }\n                {isInApprovedState > 0 && isSelfProfile > 0 &&\n                    <button id=\"startBtn\" type=\"button\" className=\"btn btn-primary btn-block m-2\" onClick={() => startFp()}>Start company</button>\n                }\n                {isModeration <= 0 && isSelfProfile <= 0 &&\n                    <div className=\"input-group m-2 w-25\">\n                        <input id=\"ethAmount\" type=\"text\" className=\"form-control\" placeholder=\"ETH amount\"\n                               aria-label=\"ETH amount\" aria-describedby=\"basic-addon2\"/>\n                        <button id=\"startBtn\" type=\"button\" className=\"btn btn-primary\" onClick={() => invest()}>Contribute</button>\n                    </div>\n                }\n            </div>\n        </li>\n    )\n}\n\nexport default withRouter(FundraisingProject);"]},"metadata":{},"sourceType":"module"}